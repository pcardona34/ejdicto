
function escape(s){var n=s;n=n.replace(/&/g,"&amp;");n=n.replace(/</g,"&lt;");n=n.replace(/>/g,"&gt;");return n;}
function diffString(o,n){let nbre=0;o=o.replace(/\s+$/,'');n=n.replace(/\s+$/,'');var out=diff(o==""?[]:o.split(/\s+/),n==""?[]:n.split(/\s+/));var str="";var oSpace=o.match(/\s+/g);if(oSpace==null){oSpace=["\n"];}else{oSpace.push("\n");}
var nSpace=n.match(/\s+/g);if(nSpace==null){nSpace=["\n"];}else{nSpace.push("\n");}
if(out.n.length==0){for(var i=0;i<out.o.length;i++){str+="<del>"+escape(out.o[i])+oSpace[i]+"</del>";nbre++;}}else{if(out.n[0].text==null){for(n=0;n<out.o.length&&out.o[n].text==null;n++){str+="<del>"+escape(out.o[n])+oSpace[n]+"</del>";nbre++;}}
for(var i=0;i<out.n.length;i++){if(out.n[i].text==null){str+="<ins>"+escape(out.n[i])+nSpace[i]+"</ins>";nbre++;}else{var pre="";for(n=out.n[i].row+1;n<out.o.length&&out.o[n].text==null;n++){pre+="<del>"+escape(out.o[n])+oSpace[n]+"</del>";nbre++;}
str+=" "+out.n[i].text+nSpace[i]+pre;}}}
let bilan="";if(nbre>0){bilan="Vous pouvez encore améliorer votre saisie.";}else{bilan="Parfait ! Aucune erreur.";}
return{bilan:bilan,corrigee:str};}
function diff(o,n){var ns=new Object();var os=new Object();for(var i=0;i<n.length;i++){if(ns[n[i]]==null)
ns[n[i]]={rows:new Array(),o:null};ns[n[i]].rows.push(i);}
for(var i=0;i<o.length;i++){if(os[o[i]]==null)
os[o[i]]={rows:new Array(),n:null};os[o[i]].rows.push(i);}
for(var i in ns){if(ns[i].rows.length==1&&typeof(os[i])!="undefined"&&os[i].rows.length==1){n[ns[i].rows[0]]={text:n[ns[i].rows[0]],row:os[i].rows[0]};o[os[i].rows[0]]={text:o[os[i].rows[0]],row:ns[i].rows[0]};}}
for(var i=0;i<n.length-1;i++){if(n[i].text!=null&&n[i+1].text==null&&n[i].row+1<o.length&&o[n[i].row+1].text==null&&n[i+1]==o[n[i].row+1]){n[i+1]={text:n[i+1],row:n[i].row+1};o[n[i].row+1]={text:o[n[i].row+1],row:i+1};}}
for(var i=n.length-1;i>0;i--){if(n[i].text!=null&&n[i-1].text==null&&n[i].row>0&&o[n[i].row-1].text==null&&n[i-1]==o[n[i].row-1]){n[i-1]={text:n[i-1],row:n[i].row-1};o[n[i].row-1]={text:o[n[i].row-1],row:i-1};}}
return{o:o,n:n};}"use strict";var carspec={};carspec.inserer=function(){var args=arguments;var car=args[0];var cible=args[1];var zone=document.getElementById(cible);zone.focus();if(typeof zone.selectionStart!='undefined')
{let start=zone.selectionStart;let end=zone.selectionEnd;let insText=zone.value.substring(start,end);zone.value=zone.value.substr(0,start)+car+zone.value.substr(end);let pos;pos=start+car.length;zone.selectionStart=pos;zone.selectionEnd=pos;document.getElementById(cible).value=zone.value;}};var dictee={saisie:"",texte:"",erreurCode:0,correction:"",message:"",titreMessage:""};dictee.init=function(){this.saisie=document.getElementById("ma_saisie").value;this.texte=document.getElementById("texte").textContent;this.erreurCode=0;this.correction="";this.message="";this.titreMessage="";if(this.saisie.length>0){if(this.texte.length>0){return true;}
else{this.erreurCode=2;console.log(this.erreurCode);return false;}}
else{this.erreurCode=1;return false;}};dictee.corriger=function(){if(this.init()===true){var sortie=diffString(this.saisie,this.texte);this.titreMessage="Bilan";this.message=sortie.bilan;this.afficherMessage();}else{if(this.erreurCode===1){this.message="Erreur "+this.erreurCode;this.message+=": veuillez d'abord saisir le texte ";this.message+="de la dictée !";this.titreMessage="Mode d'emploi";}else{this.titreMessage="Erreur dans l'application";this.message="Erreur "+this.erreurCode;this.message+=": erreur interne. Le texte de la ";this.message+="dictée est manquant :(";}
this.afficherMessage();}};dictee.terminer=function(){if(this.init()===true){var sortie=diffString(this.saisie,this.texte);this.correction=sortie.corrigee.replace(/\n/g,"<br />");document.getElementById("corrige").innerHTML=this.correction;document.getElementById("zone_correction").style.display="block";document.getElementById("menu").style.display="none";document.getElementById("zone_saisie").style.display="none";if(sessionStorage.getItem("dictee")){sessionStorage.removeItem("dictee");}
return true;}else{if(this.erreurCode===1){this.message="Erreur "+this.erreurCode;this.message+=": veuillez d'abord saisir le texte ";this.message+="de la dictée !";this.titreMessage="Mode d'emploi";}else{this.titreMessage="Erreur dans l'application";this.message="Erreur "+this.erreurCode;this.message+=": erreur interne. Le texte de la ";this.message+="dictée est manquant :(";}
this.afficherMessage();}};dictee.masquerCorrection=function(){document.getElementById("zone_correction").style.display="none";document.getElementById("zone_saisie").style.display="block";};dictee.afficherMessage=function(){document.getElementById("titre_notification").innerHTML=this.titreMessage;document.getElementById("message_notification").innerHTML=this.message;document.getElementById("notification").style.display="block";};dictee.recommencerSaisie=function(){document.getElementById("ma_saisie").value="";sessionStorage.setItem("dictee","");};var reecriture={saisie:"",initial:"",attendu:"",erreurCode:0,correction:"",message:"",titreMessage:""};reecriture.init=function(){this.saisie=document.getElementById("ma_saisie").value;this.attendu=document.getElementById("attendu").textContent;this.initial=document.getElementById("initial").textContent;this.erreurCode=0;this.correction="";this.message="";this.titreMessage="";if(this.saisie.length>0){if(this.attendu.length>0){return true;}
else{this.erreurCode=2;console.log(this.erreurCode);return false;}}
else{this.erreurCode=1;return false;}};reecriture.corriger=function(){if(this.init()===true){var sortie=diffString(this.saisie,this.attendu);this.titreMessage="Bilan";this.message=sortie.bilan;this.afficherMessage();}else{if(this.erreurCode===1){this.message="Erreur "+this.erreurCode;this.message+=" : veuillez d'abord saisir le texte ";this.message+="de la réécriture !";this.titreMessage="Mode d'emploi";}else{this.titreMessage="Erreur dans l'application";this.message="Erreur "+this.erreurCode;this.message+=" : erreur interne. Le texte de la ";this.message+="réécriture est manquant :(";}
this.afficherMessage();}};reecriture.terminer=function(){if(this.init()===true){var sortie=diffString(this.saisie,this.attendu);this.correction=sortie.corrigee.replace(/\n/g,"<br />");document.getElementById("corrige").innerHTML=this.correction;document.getElementById("zone_correction").style.display="block";document.getElementById("menu").style.display="none";document.getElementById("zone_saisie").style.display="none";if(sessionStorage.getItem("reecriture")){sessionStorage.removeItem("reecriture");}
return true;}else{if(this.erreurCode===1){this.message="Erreur "+this.erreurCode;this.message+=" : veuillez d'abord saisir le texte ";this.message+="de la réécriture !";this.titreMessage="Mode d'emploi";}else{this.titreMessage="Erreur dans l'application";this.message="Erreur "+this.erreurCode;this.message+=" : erreur interne. Le texte de la ";this.message+="réécriture est manquant :(";}
this.afficherMessage();}};reecriture.masquerCorrection=function(){document.getElementById("zone_correction").style.display="none";document.getElementById("zone_saisie").style.display="block";};reecriture.afficherMessage=function(){document.getElementById("titre_notification").innerHTML=this.titreMessage;document.getElementById("message_notification").innerHTML=this.message;document.getElementById("notification").style.display="block";};reecriture.recommencerSaisie=function(){document.getElementById("ma_saisie").value=document.getElementById("initial").textContent;sessionStorage.clear();};